==============
Fri Dec 5 2014

Summary of discussions regarding the front-end app to date.

========================
Initial View / Home Page
========================

We assume user authentication will be handled by Ryan @ CalRecycle.
The app's initial view will appear after the user logs in.

[BK] The app will need to store some kind of authentication token it
receives from CalRecycle, and send it as a URL parameter for every request
that requires authentication (basically, for every request that begins with
/scenarios/x/... where the requested scenario is not in ScenarioGroup 0).

Brandon has requested that the initial view contain a list of  
scenarios and a list of LCIA methods. He is open to Sabina's suggestion that 
the initial view be a visualization that provides a bird's eye view of 
all LCIA results. This visualization would contain links that would allow 
the user to drill down to more detailed views.

------------------
Scenario List View
------------------
Table of user's scenarios containing hyperlinks to other views
Scenario name 		-> Scenario Parameter View
Top-Level Fragment name -> Fragment Sankey View

-----------------------
Scenario Parameter View
-----------------------
Contains table of all parameters for the selected scenario and displays 
user's pending changes to the parameters.

 * Parameter table columns
   - Type
   - Descriptor (auto-generated)
   - Name (optional, created by user)
   - Original value (current value before change?)
   - New value (pending value change?)

 User clicks on Apply button to send parameter changes to back end via web API.
 Parameter changes will impact results, so the front-end should clear its own
 cached results and get new results from the web API after the Apply action.

---------------------
LCIA Method List View
---------------------
Table of LCIA methods with check box column that allows user to choose which 
methods will be shown in LCIA result views.
LCIA method name will be a hyperlink to LCIA detail view.

-----------------------
LCIA Method Detail View
-----------------------
 * Displays LCIA Method properties

 * Contains table of all LCIA Characterization Factors for the selected method.
   For every factor that has a parameter, the parameter will be displayed on the 
   same row.
   Table columns:
   - Flow name
   - Composition
   - Name (optional, created by user)
   - Original value (current value before change?)
   - New value (pending value change?)
   
 * User may create and update LCIA Characterization Factor parameters here. 
   These changes should not be sent to the web API immediately. 
   They should appear in the Scenario Detail view as pending changes.

 * LCIA Factor table columns
   - Flow Name
   - Composition
   - Factor
   - Parameter name (optional)
   - Parameter value

------------------------
Process LCIA Detail View
------------------------
User navigates here from a process node in the Fragment Sankey view. 
Therefore, this view has a scenario, fragment flow, and process context.
The activity level from fragment flow navigation is also applied.

For every active LCIA method, if details are in process LCIA results,
this view contains a segmented bar chart of Process LCIA result details. 
Relevant parameters should be displayed near the result details.
The relevant parameter types are 4, 6, 8, and 10?

[BK] Type 4 params are not relevant to the Process LCIA view.  For now,
only type 8+10 are relevant.  (Type 5+6 would be relevant if the dissipation
code ever gets written.)


=========
Questions
=========

 1. How/where is parameter descriptor generated?

    [BK] the parameter descriptor is simply the concatenation of names of
    the IDs listed in the ParamResource-- e.g. Process and Flow for types 6
    and 8; LCIA Method + Flow for type 10; FragmentFlow for types 1+2.

    They should be generated on the fly from the front end in the Scenario
    Detail View only.  They are not needed elsewhere.

 2. Please specify web API actions to execute when parameter changes are applied.

    [BK] PUT or POST a list of ParamResources.  Alternatively, PUT or POST
    a ScenarioDetailResource containing a list of ParamResources.

    Note-- I can't think of a good reason to distinguish between PUT and
    POST methods.  Each param is uniquely determined by its reference
    IDs... so, if the param doesn't exist, create it; if it does exist;
    update it.  

    If you think it's important to treat POST and PUT differently, then the
    frontend will have to do two API calls- one to POST new params, and the
    other to PUT changes to existing params.

 3. Do we have a web API method for getting LCIA characterization factors?

    [BK] Not presently! I guess we need one.

 4. LCIA Method Detail view does not have scenario context.
    How will user assign LCIA Characterization Factor parameter to scenario?

    [BK] The Frontend should have in mind an "active" scenario.  It should
    also know whether the user is authorized to edit the active scenario.
    This can be determined from the Scenario.ScenarioGroup entry.  If the
    ScenarioGroup is 1, the scenario may not be edited.  If the
    ScenarioGroup is non-1, it can be edited.

 5. Need help describing the parameter table in the Process LCIA details view.

    OK-- noted.    
    Here's a try:
    Flow Name | Flow Category | EF | CF | Result

    EF = Emission Factor = ProcessFlow.Result 
       	 	  	   OR Param.Value for Type 8 Params

    CF = Characterization Factor = LCIA.Factor
       	 		  	   OR Param.Value for Type 10 Params

    Result = EF * CF

    User should be able to select any EF and parameterize it, creating a
    new type 8 param; or any CF and parameterize it, creating a new type 10
    param. 





==========
Mon Sep 15 23:08:04 PDT 2014

Application state: stored in client

User has access to a set of scenario groups, that are determined
based on authentication-

The server should tell the API who is making the request, and the DB should
just have a mapping of UserIDs to Scenario Groups-- each user gets its own,
plus more can be shared.  so only for sharing do we need a table. UserID
and ScenarioGroupID can be synonymous.

so: a user has access to a set of scenarios and can create new ones.  To
create a new scenario: select an existing scenario to duplicate, or start
from scratch.

components of a scenario:

 * a list of Params: Type, Name, type-specific mapping, value, metadata

   - dependency params: (type 1, 2, 3) apply to FragmentFlows
   - flow property params: (type 4) apply to FlowFlowProperty entries
   - [composition params: type 5; currently unsupported]
   - emission factor params: (type 8) apply to ProcessFlow entries
   - dissipation factor params: (type 6)" ", via composition model
   - characterization params: (type 10) apply to LCIA entries

 * a list of substitutions:

   - process / fragment substitutions
   - background substitutions
   - composition substitutions

All params and substitutions are applied during the computation routines
and cached by scenario.

Users interact with the database by:

 (1) navigating the model graphically using the sankey diagrams
 (2) inspecting resources via query views
 (3) designing scenarios by creating and adjusting params, either 
     - during interactive traversal or 
     - via menu-driven access


============
Initial View
============

Upon connecting to the service, the user should see a menu of options,
including:

 * Scenario Viewer (--> sankey view)
 * Process Inspector (--> process LCIA view)
 * [imtermediate] Flow Inspector (--> table views; composition models)
 * Background Resolution
 * LCIA Method Inspector

The Frontend should remember session information about the user, such as:

  - what scenarios are available
  - ScenarioID selection list
  - LCIAMethodID selection list
  - currently active scenario (edits apply to active scenario)
  - local list of params to be added / changed / removed from scenario 

  - any cached db information, e.g. flow list + process list

---------------
Scenario Viewer
---------------

list of scenarios available to the user:

 - name, group ID- visibility - can edit?
 - reference flow and activity level of top-level fragment
 - view in sankey viewer
 - view/edit as parameter list
 (- compute LCI)

 - waterfalls? or access those via sankey view

 - compare scenarios by LCIA score?


-----------------
Process Inspector
-----------------

 - all processes pulldown list
   * filters: processes with emissions / ?

 - tabular (or sankey?) list of intermediate flows
 - lcia pulldown list
 - segmented barchart showing unit LCIA score and breakdown

 -? if ProcessComposition, ... show composition profile?
   * table of CompositionData->FlowPropertyEmission->ProcessDissipation

 -? if scenario, show params:
   * type [5,]6- labeled in ProcessComposition table
   * type 8- labeled in segmented barchart view / list

   * type 10- labeled in segmented barchart view if applicable

 -? support param PUT + POST if user has permissions on scenario

--------------
Flow Inspector
--------------

 - select elementary / intermediate

 - if elementary.. that's a doozy of a list
   * maybe allow user to select by classification

 - if intermediate, a pulldown should suffice

 - shows:
   * flow metadata
   * classification
   * if elementary: show all LCIA factors
   * if intermediate: show all flowproperties

 - if flow appears in CompositionModel, show available composition models

 - if scenario: GET/PUT/POST type 4 (flowproperty) and type 10 (lcia)
   params; select alternate composition model

   - where does one input alternate composition models? here, presumably

---------------------
LCIA Method Inspector
---------------------

gah

